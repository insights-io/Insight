name: Publish Docker
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
    - name: auth-api
      uses: elgohr/Publish-Docker-Github-Action@master
      with:
        name: insights-io/Insight/auth-api
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}
        registry: docker.pkg.github.com
        dockerfile: auth/auth-api/docker/Dockerfile.jvm
        workdir: backend
    - name: auth-api-migrations
      uses: elgohr/Publish-Docker-Github-Action@master
      with:
        name: insights-io/Insight/auth-api-migrations
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}
        registry: docker.pkg.github.com
        dockerfile: Dockerfile
        workdir: backend/auth/auth-api/migrations/
    - name: session-api
      uses: elgohr/Publish-Docker-Github-Action@master
      with:
        name: insights-io/Insight/session-api
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}
        registry: docker.pkg.github.com
        dockerfile: session/session-api/docker/Dockerfile.jvm
        workdir: backend
    - name: session-api-migrations
      uses: elgohr/Publish-Docker-Github-Action@master
      with:
        name: insights-io/Insight/session-api-migrations
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}
        registry: docker.pkg.github.com
        dockerfile: Dockerfile
        workdir: backend/session/session-api/migrations
    - name: beacon-api
      uses: elgohr/Publish-Docker-Github-Action@master
      with:
        name: insights-io/Insight/beacon-api
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}
        registry: docker.pkg.github.com
        dockerfile: beacon/beacon-api/docker/Dockerfile.jvm
        workdir: backend
    - name: search-indexer
      uses: elgohr/Publish-Docker-Github-Action@master
      with:
        name: insights-io/Insight/search-indexer
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}
        registry: docker.pkg.github.com
        dockerfile: events/search-indexer/docker/Dockerfile.jvm
        workdir: backend
    - name: frontend
      uses: elgohr/Publish-Docker-Github-Action@master
      with:
        name: insights-io/Insight/frontend
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}
        registry: docker.pkg.github.com
        dockerfile: frontend/app/docker/Dockerfile
