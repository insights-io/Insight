---
name: Docker
on: [push]

jobs:
  build-auth-api:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - name: backend/auth-api
        uses: elgohr/Publish-Docker-Github-Action@master
        with:
          name: insights-io/Insight/auth-api
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
          registry: docker.pkg.github.com
          dockerfile: auth/auth-api/docker/Dockerfile.jvm
          workdir: backend

  build-auth-api-migrations:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - name: backend/auth-api-migrations
        uses: elgohr/Publish-Docker-Github-Action@master
        with:
          name: insights-io/Insight/auth-api-migrations
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
          registry: docker.pkg.github.com
          dockerfile: Dockerfile
          workdir: backend/auth/auth-api/migrations/

  build-session-api:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - name: backend/session-api
        uses: elgohr/Publish-Docker-Github-Action@master
        with:
          name: insights-io/Insight/session-api
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
          registry: docker.pkg.github.com
          dockerfile: session/session-api/docker/Dockerfile.jvm
          workdir: backend

  build-session-api-migrations:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - name: backend/session-api-migrations
        uses: elgohr/Publish-Docker-Github-Action@master
        with:
          name: insights-io/Insight/session-api-migrations
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
          registry: docker.pkg.github.com
          dockerfile: Dockerfile
          workdir: backend/session/session-api/migrations

  build-beacon-api:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - name: backend/beacon-api
        uses: elgohr/Publish-Docker-Github-Action@master
        with:
          name: insights-io/Insight/beacon-api
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
          registry: docker.pkg.github.com
          dockerfile: beacon/beacon-api/docker/Dockerfile.jvm
          workdir: backend

  build-search-indexer:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - name: backend/search-indexer
        uses: elgohr/Publish-Docker-Github-Action@master
        with:
          name: insights-io/Insight/search-indexer
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
          registry: docker.pkg.github.com
          dockerfile: events/search-indexer/docker/Dockerfile.jvm
          workdir: backend

  build-frontend-app:
    runs-on: ubuntu-latest
    steps:
      - name: frontend/app
        uses: elgohr/Publish-Docker-Github-Action@master
        with:
          name: insights-io/Insight/frontend-app
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
          registry: docker.pkg.github.com
          dockerfile: frontend/app/docker/Dockerfile
          workdir: .
